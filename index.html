// config.js - Configuration management
class AppConfig {
    constructor() {
        this.loadEnvironmentConfig();
    }

    loadEnvironmentConfig() {
        // Load configuration from environment variables or defaults
        window.APP_CONFIG = {
            // Translation API Keys (set these in your environment)
            GOOGLE_TRANSLATE_API_KEY: process?.env?.GOOGLE_TRANSLATE_API_KEY || '',
            MICROSOFT_TRANSLATOR_KEY: process?.env?.MICROSOFT_TRANSLATOR_KEY || '',
            DEEPL_API_KEY: process?.env?.DEEPL_API_KEY || '',
            
            // Backend API endpoint
            API_ENDPOINT: process?.env?.API_ENDPOINT || '',
            
            // Feature flags
            ENABLE_GOOGLE_TRANSLATE: true,
            ENABLE_MICROSOFT_TRANSLATE: true,
            ENABLE_DEEPL_TRANSLATE: true,
            ENABLE_ANALYTICS: false,
            
            // App settings
            DEBUG_MODE: process?.env?.NODE_ENV === 'development',
            MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
            SUPPORTED_LANGUAGES: [
                'en', 'es', 'fr', 'de', 'it', 'pt', 'ru', 'zh', 'zh-TW', 
                'ja', 'ko', 'ar', 'hi', 'th', 'vi', 'pl', 'nl', 'sv', 
                'tr', 'no', 'da', 'fi', 'he', 'fa'
            ],
            
            // Security settings
            ALLOW_EXTERNAL_LINKS: false,
            SANITIZE_INPUT: true,
            
            // Performance settings
            TRANSLATION_CACHE_TTL: 24 * 60 * 60 * 1000, // 24 hours
            MAX_TRANSLATION_REQUESTS_PER_MINUTE: 10,
            
            // UI settings
            DEFAULT_LANGUAGE: 'en',
            SHOW_CONFIDENCE_SCORES: true,
            ENABLE_OFFLINE_MODE: true
        };
    }

    // Get configuration value with fallback
    get(key, defaultValue = null) {
        return window.APP_CONFIG?.[key] ?? defaultValue;
    }

    // Set configuration value
    set(key, value) {
        if (window.APP_CONFIG) {
            window.APP_CONFIG[key] = value;
        }
    }

    // Check if feature is enabled
    isFeatureEnabled(feature) {
        return this.get(`ENABLE_${feature.toUpperCase()}`, false);
    }

    // Get supported languages
    getSupportedLanguages() {
        return this.get('SUPPORTED_LANGUAGES', ['en']);
    }

    // Validate configuration
    validate() {
        const required = [];
        const warnings = [];

        // Check if at least one translation service is configured
        const hasGoogleKey = !!this.get('GOOGLE_TRANSLATE_API_KEY');
        const hasMicrosoftKey = !!this.get('MICROSOFT_TRANSLATOR_KEY');
        const hasDeepLKey = !!this.get('DEEPL_API_KEY');
        const hasBackendAPI = !!this.get('API_ENDPOINT');

        if (!hasGoogleKey && !hasMicrosoftKey && !hasDeepLKey && !hasBackendAPI) {
            warnings.push('No translation service configured. Translation will not work.');
        }

        return {
            isValid: required.length === 0,
            errors: required,
            warnings: warnings
        };
    }
}

// Initialize configuration
window.appConfig = new AppConfig();

// =======================
// package.json - Dependencies and scripts
const packageJson = {
    "name": "discharge-instructions-translator",
    "version": "1.0.0",
    "description": "Translate medical discharge instructions into patient's preferred language",
    "main": "index.html",
    "scripts": {
        "start": "http-server -p 8080 -c-1",
        "build": "npm run build:css && npm run build:js",
        "build:css": "postcss styles.css -o dist/styles.min.css",
        "build:js": "webpack --mode production",
        "dev": "webpack serve --mode development",
        "test": "jest",
        "lint": "eslint js/**/*.js",
        "deploy": "npm run build && gh-pages -d dist"
    },
    "keywords": [
        "medical",
        "translation",
        "healthcare",
        "discharge",
        "patient-care",
        "multilingual"
    ],
    "author": "Your Name",
    "license": "MIT",
    "dependencies": {
        "qr-scanner": "^1.4.2"
    },
    "devDependencies": {
        "webpack": "^5.88.0",
        "webpack-cli": "^5.1.0",
        "webpack-dev-server": "^4.15.0",
        "babel-loader": "^9.1.0",
        "@babel/core": "^7.22.0",
        "@babel/preset-env": "^7.22.0",
        "css-loader": "^6.8.0",
        "style-loader": "^3.3.0",
        "mini-css-extract-plugin": "^2.7.0",
        "html-webpack-plugin": "^5.5.0",
        "workbox-webpack-plugin": "^7.0.0",
        "eslint": "^8.44.0",
        "jest": "^29.6.0",
        "http-server": "^14.1.1",
        "gh-pages": "^5.0.0",
        "postcss": "^8.4.24",
        "autoprefixer": "^10.4.14",
        "cssnano": "^6.0.1"
    },
    "browserslist": [
        "> 1%",
        "last 2 versions",
        "not dead"
    ]
};

// =======================
// manifest.json - PWA manifest
const manifestJson = {
    "name": "Discharge Instructions Translator",
    "short_name": "DischargeTranslator",
    "description": "Translate medical discharge instructions into your preferred language",
    "version": "1.0.0",
    "start_url": "/",
    "display": "standalone",
    "orientation": "portrait",
    "theme_color": "#667eea",
    "background_color": "#ffffff",
    "scope": "/",
    "lang": "en",
    "icons": [
        {
            "src": "icons/icon-72x72.png",
            "sizes": "72x72",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-96x96.png",
            "sizes": "96x96",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-128x128.png",
            "sizes": "128x128",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-144x144.png",
            "sizes": "144x144",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-152x152.png",
            "sizes": "152x152",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-192x192.png",
            "sizes": "192x192",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-384x384.png",
            "sizes": "384x384",
            "type": "image/png",
            "purpose": "maskable any"
        },
        {
            "src": "icons/icon-512x512.png",
            "sizes": "512x512",
            "type": "image/png",
            "purpose": "maskable any"
        }
    ],
    "categories": ["medical", "healthcare", "utilities"],
    "screenshots": [
        {
            "src": "screenshots/desktop-1.png",
            "sizes": "1280x720",
            "type": "image/png",
            "platform": "wide",
            "label": "Desktop view of the discharge translator"
        },
        {
            "src": "screenshots/mobile-1.png",
            "sizes": "360x640",
            "type": "image/png",
            "platform": "narrow",
            "label": "Mobile view of the QR scanner"
        }
    ],
    "features": [
        "QR Code scanning",
        "Multi-language translation",
        "Offline functionality",
        "Print and share capabilities"
    ]
};

// =======================
// .env.example - Environment variables template
const envExample = `# Translation API Keys
GOOGLE_TRANSLATE_API_KEY=your_google_translate_api_key_here
MICROSOFT_TRANSLATOR_KEY=your_microsoft_translator_key_here
DEEPL_API_KEY=your_deepl_api_key_here

# Backend API (if using custom translation service)
API_ENDPOINT=https://your-api-endpoint.com

# Environment
NODE_ENV=production

# Features (true/false)
ENABLE_ANALYTICS=false
ENABLE_DEBUG_MODE=false

# Security
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
`;

// =======================
// .gitignore
const gitignore = `# Dependencies
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Environment variables
.env
.env.local
.env.development
.env.production

# Build outputs
dist/
build/
*.min.js
*.min.css

# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Coverage directory used by tools like istanbul
coverage/
*.lcov

# nyc test coverage
.nyc_output

# Dependency directories
node_modules/
jspm_packages/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# next.js build output
.next

# nuxt.js build output
.nuxt

# vuepress build output
.vuepress/dist

# Serverless directories
.serverless

# IDE files
.vscode/
.idea/
*.swp
*.swo
*~

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Temporary files
*.tmp
*.temp

# API keys and secrets
secrets/
*.key
*.pem
`;

// =======================
// webpack.config.js - Build configuration
const webpackConfig = `const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const { WorkboxPlugin } = require('workbox-webpack-plugin');

module.exports = (env, argv) => {
    const isProduction = argv.mode === 'production';
    
    return {
        entry: {
            app: './js/app.js'
        },
        output: {
            path: path.resolve(__dirname, 'dist'),
            filename: isProduction ? '[name].[contenthash].js' : '[name].js',
            clean: true
        },
        module: {
            rules: [
                {
                    test: /\.js$/,
                    exclude: /node_modules/,
                    use: {
                        loader: 'babel-loader',
                        options: {
                            presets: ['@babel/preset-env']
                        }
                    }
                },
                {
                    test: /\.css$/,
                    use: [
                        isProduction ? MiniCssExtractPlugin.loader : 'style-loader',
                        'css-loader',
                        {
                            loader: 'postcss-loader',
                            options: {
                                postcssOptions: {
                                    plugins: [
                                        require('autoprefixer'),
                                        ...(isProduction ? [require('cssnano')] : [])
                                    ]
                                }
                            }
                        }
                    ]
                },
                {
                    test: /\\.(png|svg|jpg|jpeg|gif)$/i,
                    type: 'asset/resource'
                },
                {
                    test: /\\.(woff|woff2|eot|ttf|otf)$/i,
                    type: 'asset/resource'
                }
            ]
        },
        plugins: [
            new HtmlWebpackPlugin({
                template: './index.html',
                filename: 'index.html',
                inject: true,
                minify: isProduction ? {
                    removeComments: true,
                    collapseWhitespace: true,
                    removeRedundantAttributes: true,
                    useShortDoctype: true,
                    removeEmptyAttributes: true,
                    removeStyleLinkTypeAttributes: true,
                    keepClosingSlash: true,
                    minifyJS: true,
                    minifyCSS: true,
                    minifyURLs: true
                } : false
            }),
            ...(isProduction ? [
                new MiniCssExtractPlugin({
                    filename: '[name].[contenthash].css'
                }),
                new WorkboxPlugin.GenerateSW({
                    clientsClaim: true,
                    skipWaiting: true,
                    runtimeCaching: [
                        {
                            urlPattern: /^https:\\/\\/cdnjs\\.cloudflare\\.com\\//,
                            handler: 'CacheFirst',
                            options: {
                                cacheName: 'external-libs',
                                expiration: {
                                    maxEntries: 10,
                                    maxAgeSeconds: 30 * 24 * 60 * 60 // 30 days
                                }
                            }
                        },
                        {
                            urlPattern: /^https:\\/\\/.*\\.googleapis\\.com\\//,
                            handler: 'NetworkFirst',
                            options: {
                                cacheName: 'google-apis',
                                networkTimeoutSeconds: 3
                            }
                        }
                    ]
                })
            ] : [])
        ],
        devServer: {
            static: {
                directory: path.join(__dirname, 'dist')
            },
            compress: true,
            port: 8080,
            hot: true,
            open: true,
            https: true, // Required for camera access
            historyApiFallback: true
        },
        optimization: {
            splitChunks: {
                chunks: 'all',
                cacheGroups: {
                    vendor: {
                        test: /[\\\\/]node_modules[\\\\/]/,
                        name: 'vendors',
                        chunks: 'all'
                    }
                }
            }
        },
        devtool: isProduction ? 'source-map' : 'eval-source-map'
    };
};`;

// =======================
// README.md content
const readmeContent = `# Discharge Instructions Translator

A production-ready web application that translates medical discharge instructions into the patient's preferred language using QR code scanning or manual input.

## 🌟 Features

- **Multi-language Support**: 25+ languages including Spanish, French, German, Chinese, Arabic, and more
- **QR Code Scanning**: Scan discharge instruction QR codes using device camera
- **Manual Input**: Type or paste discharge information directly
- **Medical Data Parsing**: Intelligent parsing of medical terminology and structured data
- **Multiple Translation APIs**: Support for Google Translate, Microsoft Translator, and DeepL
- **Offline Capable**: Progressive Web App with offline functionality
- **Print & Share**: Print instructions or share via native sharing APIs
- **HIPAA Compliant**: No data stored on servers, all processing done locally
- **Mobile Responsive**: Works on all devices and screen sizes

## 🚀 Quick Start

### 1. Clone and Setup
\`\`\`bash
git clone https://github.com/yourusername/discharge-translator.git
cd discharge-translator
npm install
\`\`\`

### 2. Configure API Keys
Copy \`.env.example\` to \`.env\` and add your translation API keys:
\`\`\`bash
cp .env.example .env
# Edit .env with your API keys
\`\`\`

### 3. Run Development Server
\`\`\`bash
npm run dev
\`\`\`

### 4. Build for Production
\`\`\`bash
npm run build
\`\`\`

## 🔧 Configuration

### Translation APIs

The app supports multiple translation services with automatic fallback:

#### Google Translate API
\`\`\`env
GOOGLE_TRANSLATE_API_KEY=your_key_here
\`\`\`

#### Microsoft Translator
\`\`\`env
MICROSOFT_TRANSLATOR_KEY=your_key_here
\`\`\`

#### DeepL API
\`\`\`env
DEEPL_API_KEY=your_key_here
\`\`\`

### Custom Backend API
\`\`\`env
API_ENDPOINT=https://your-api-endpoint.com
\`\`\`

## 📁 Project Structure

\`\`\`
discharge-translator/
├── index.html              # Main HTML file
├── styles.css              # Main stylesheet
├── js/
│   ├── app.js              # Main application controller
│   ├── translator.js       # Translation service
│   ├── medical-parser.js   # Medical data parser
│   ├── qr-scanner.js       # QR code scanning
│   ├── ui-controller.js    # UI management
│   └── config.js           # Configuration management
├── icons/                  # PWA icons
├── screenshots/           # App screenshots
├── manifest.json          # PWA manifest
├── sw.js                  # Service worker
├── package.json           # Dependencies
├── webpack.config.js      # Build configuration
└── README.md             # This file
\`\`\`

## 🏥 Medical Data Format

The app can parse various formats:

### Structured JSON (Recommended)
\`\`\`json
{
  "patient": {
    "name": "John Doe",
    "dob": "1980-01-01",
    "mrn": "12345"
  },
  "diagnoses": ["Hypertension", "Type 2 Diabetes"],
  "medications": [
    "Lisinopril 10mg once daily",
    "Metformin 500mg twice daily"
  ],
  "instructions": [
    "Take medications as prescribed",
    "Follow up with primary care in 1 week"
  ],
  "return_reasons": [
    "Severe chest pain",
    "Difficulty breathing"
  ]
}
\`\`\`

### Unstructured Text
The parser can also handle plain text discharge instructions and will attempt to categorize the information automatically.

## 🔒 Security & Privacy

- **No Data Storage**: Medical information is processed locally and never stored on servers
- **HTTPS Required**: Camera access requires secure connections
- **Input Sanitization**: All user input is sanitized to prevent XSS attacks
- **HIPAA Compliance**: Designed to meet healthcare privacy requirements

## 🌐 Deployment

### GitHub Pages
\`\`\`bash
npm run deploy
\`\`\`

### Docker
\`\`\`dockerfile
FROM nginx:alpine
COPY dist/ /usr/share/nginx/html/
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
\`\`\`

### Netlify/Vercel
The app can be deployed to any static hosting service. Make sure to:
1. Set environment variables in your hosting platform
2. Configure HTTPS (required for camera access)
3. Set up proper redirects for SPA routing

## 🧪 Testing

\`\`\`bash
# Run tests
npm test

# Run linting
npm run lint

# Test with sample data
npm run test:sample-data
\`\`\`

## 📱 Browser Support

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

### Required Features
- Camera API (for QR scanning)
- Fetch API (for translations)
- Service Workers (for offline functionality)
- ES6+ Support

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## 📄 License

MIT License - see [LICENSE](LICENSE) file for details.

## ⚕️ Medical Disclaimer

This application is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of qualified healthcare providers with questions about medical conditions.

## 🆘 Support

- Check the [Issues](https://github.com/yourusername/discharge-translator/issues) page
- Review the troubleshooting section below
- Contact your healthcare facility's IT support

## 🔧 Troubleshooting

### QR Scanner Issues
- Ensure camera permissions are granted
- Check that you're using HTTPS
- Try refreshing the page
- Use manual input as fallback

### Translation Issues
- Verify API keys are correctly configured
- Check network connectivity
- Some medical terms may require clarification from healthcare providers

### Performance Issues
- Clear browser cache
- Disable browser extensions
- Use a modern browser
- Check internet connection

## 🔮 Roadmap

- [ ] Voice input support
- [ ] Medication reminder integration
- [ ] Multiple file format support (PDF, DOCX)
- [ ] Advanced medical terminology database
- [ ] Integration with EHR systems
- [ ] Appointment scheduling links
- [ ] Medication interaction checking

---

Made with ❤️ for better patient care`;

// Export all configuration
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        packageJson,
        manifestJson,
        envExample,
        gitignore,
        webpackConfig,
        readmeContent
    };
}
    
